= ‚úàÔ∏è TP : Cas Yak-√†-Partir - S√©curisation & D√©veloppement
:author: Professeur SIO
:revdate: 2025-05-31
:toc: left
:toc-title: Sommaire
:icons: font
:source-highlighter: highlightjs
:sectnums:

== üéØ Contexte de la mission

Vous int√©grez l'√©quipe de d√©veloppement de **Breizh-SN**.
Votre mission consiste √† s√©curiser et unifier les applications de l'agence de voyage *Yak-√†-Partir*.

Ce projet regroupe les volets techniques et organisationnels de l'√©tude de cas :

* **Java** : Gestion des utilisateurs (Client lourd).
* **SQL** : Unification des bases de donn√©es & RGPD.
* **Web (PHP)** : Protection CSRF & Analyse de logs.

[IMPORTANT]
====
**Consignes de rendu :**
. Le code doit √™tre fonctionnel dans ce projet IntelliJ.
. Les r√©ponses aux questions th√©oriques (Analyses, RGPD, EBIOS...) doivent √™tre r√©dig√©es dans un fichier nomm√© `RAPPORT.md` ou `RAPPORT.adoc` √† la racine du projet.
====

== üìÅ Dossier A : Application Java (S√©curit√© Applicative)

**Objectif** : Impl√©menter les r√®gles de s√©curit√© pour les mots de passe et les habilitations.

=== üìù Analyse & R√©flexion
_(√Ä r√©diger dans votre rapport)_

. **Documentation (Question A1.2)**
* Proposez une documentation au format **Javadoc** pour la m√©thode `modifierMdp` de la classe `Utilisateur`.

. **Sc√©nario de risque (Question A3.2)**
* D√©crivez un sc√©nario de risque concret exploitant l'absence de restriction d'acc√®s aux √©l√©ments du menu de l'application (avant la mise en place des habilitations).
* _Indice : Que se passe-t-il si un stagiaire acc√®de au menu "Comptabilit√©" ?_

=== üõ†Ô∏è T√¢ches Techniques

. **Analyse du code (Question A1.1)**
* Localisez `src/main/java/model/Utilisateur.java`.
* Corrigez les erreurs de nommage (Conventions Java) dans les m√©thodes existantes (ex: `ancienMdp`).

. **Impl√©mentation (Questions A2.1 & A2.2)**
* Compl√©tez la m√©thode `modifierMdp` pour respecter la politique de s√©curit√© :
** Longueur >= 12 caract√®res.
** Au moins 1 majuscule, 3 minuscules, 4 chiffres, 1 caract√®re sp√©cial.
** Le mot de passe ne doit pas avoir d√©j√† √©t√© utilis√©.

. **Validation (Question A3.1)**
* Ouvrez `src/test/java/test/UtilisateurTest.java`.
* Ex√©cutez les tests (Barre verte requise).

== üìÅ Dossier B : Base de Donn√©es (Int√©grit√© & RGPD)

**Objectif** : Fusionner les bases, g√©rer le consentement RGPD et emp√™cher les fraudes.

=== üìù Analyse & R√©flexion
_(√Ä r√©diger dans votre rapport)_

. **Classification des donn√©es (Question B1.1)**
* R√©alisez un tableau (DICP ou simple liste) recensant les **donn√©es personnelles** et les **donn√©es sensibles** pr√©sentes dans la base de donn√©es (Voir Sch√©ma `script_yak.sql`).

. **Communication Utilisateur (Question B1.3)**
* R√©digez le corps du courriel √† envoyer aux clients pour les avertir de la fusion des bases et r√©colter leur consentement pour le publipostage (Lien vers formulaire).

. **Preuve de consentement (Question B1.4)**
* Proposez une solution technique d√©taill√©e pour conserver une trace int√®gre du consentement (Logs sign√©s, Blockchain, Tiers de confiance...).

. **Analyse de Risques EBIOS (Question B2.1)**
* Justifiez le niveau de gravit√© (1 √† 4) pour les risques suivants :
** **R1** : Injection SQL permettant de modifier un acompte.
** **R2** : Injection SQL permettant de r√©duire le prix sous le seuil de rentabilit√©.

=== üõ†Ô∏è T√¢ches Techniques

. **Initialisation**
* Ex√©cutez `sql_database/script_yak.sql` dans votre base locale.

. **Modification RGPD (Question B1.2)**
* √âcrivez et ex√©cutez la requ√™te `ALTER TABLE` pour ajouter le champ `accordPubli` (bool√©en, d√©faut FAUX).

. **S√©curisation par Trigger (Questions B2.2 & B2.3)**
* Compl√©tez le trigger `before_insert_contrat_voyage` pour bloquer les contrats inf√©rieurs √† **75‚Ç¨ / jour / personne**.
* V√©rifiez son fonctionnement en tentant d'ins√©rer des donn√©es invalides.

== üìÅ Dossier C : Web & PHP (Failles & Incidents)

**Objectif** : S√©curiser l'application contre le CSRF et analyser les incidents de s√©curit√©.

=== üìù Analyse & R√©flexion
_(√Ä r√©diger dans votre rapport)_

. **Compr√©hension CSRF (Question C1.1)**
* Expliquez bri√®vement le principe de la faille CSRF et comment le jeton (token) prot√®ge l'application.

. **Analyse de Logs (Question C2.1)**
* Voici un extrait du fichier de journalisation :
+
----
[21:41:18] NOTICE: utilisateur AllanG : erreur de connexion
[21:41:20] WARNING: utilisateur : essai de connexion avec champs vides
[21:41:24] NOTICE: utilisateur RichardP : erreur de connexion
[21:41:24] NOTICE: utilisateur RichardP : erreur de connexion
[21:41:24] NOTICE: utilisateur RichardP : erreur de connexion
[21:41:26] NOTICE: utilisateur AllanG : s‚Äôest connect√© correctement
[21:41:26] NOTICE: utilisateur RichardP : erreur de connexion
----
* Identifiez les √©v√©nements suspects. √âmettez une hypoth√®se sur l'attaque en cours concernant l'utilisateur `RichardP`.

. **D√©sactivation de compte (Question C2.3)**
* Proposez une solution technique (MCD ou Algorithme) pour d√©sactiver automatiquement un compte apr√®s 5 √©checs successifs.

=== üõ†Ô∏è T√¢ches Techniques

. **Audit et Correction (Mission C1)**
* Ouvrez `web_app/modifMdp.php`.
* Impl√©mentez la protection par **Token Anti-CSRF** (G√©n√©ration en session + Champ cach√© + V√©rification dans `traitement.php`).

[WARNING]
====
Pensez √† configurer l'interpr√©teur PHP dans IntelliJ pour profiter de l'autocompl√©tion et de la d√©tection d'erreurs.
====



== üìÅ Dossier A : Application Java (S√©curit√© Applicative)

**Objectif** : Impl√©menter les r√®gles de s√©curit√© pour les mots de passe et les habilitations.

=== üõ†Ô∏è T√¢ches √† r√©aliser

. **Analyse**
* Localisez la classe `src/main/java/model/Utilisateur.java`.
* Rep√©rez les m√©thodes laiss√©es vides (`modifierMdp`, etc.).

. **Impl√©mentation (Questions A1 & A2)**
* Compl√©tez le code pour respecter les r√®gles de complexit√© du mot de passe.
* Assurez-vous que l'historique des mots de passe est bien v√©rifi√©.

. **Validation (Question A3)**
* Ouvrez `src/test/java/test/UtilisateurTest.java`.
* Ex√©cutez les tests en cliquant sur la fl√®che verte (Run).

[NOTE]
====
L'objectif est d'obtenir une barre **verte** (Tests Passed). Tant que la barre est rouge, votre code m√©tier ne respecte pas les consignes.
====

== üìÅ Dossier B : Base de Donn√©es (Int√©grit√©)

**Objectif** : Fusionner les bases et emp√™cher les fraudes comptables via des d√©clencheurs.

=== üõ†Ô∏è T√¢ches √† r√©aliser

. **Initialisation**
* Ouvrez le fichier `sql_database/script_yak.sql`.
* Connectez IntelliJ √† votre base de donn√©es locale (Onglet _Database_ √† droite -> `+` -> MySQL).
* Ex√©cutez le script pour cr√©er les tables.

. **√âvolution du sch√©ma (Question B1)**
* R√©digez et ex√©cutez la requ√™te `ALTER TABLE` pour ajouter le consentement publipostage (`accordPubli`).

. **S√©curisation par Trigger (Question B2)**
* Compl√©tez le trigger `before_insert_contrat_voyage`.
* Il doit bloquer tout contrat dont le prix est inf√©rieur √† **75‚Ç¨ / jour / personne**.

[TIP]
====
Pour tester votre trigger, tentez d'ins√©rer un contrat frauduleux via la console SQL :
`INSERT INTO Contrat_Voyage ...`
Vous devez voir appara√Ætre votre message d'erreur personnalis√© (`SIGNAL SQLSTATE`).
====

== üìÅ Dossier C : Web & PHP (Failles CSRF)

**Objectif** : S√©curiser le formulaire de changement de mot de passe.

=== üõ†Ô∏è T√¢ches √† r√©aliser

. **Audit du code**
* Ouvrez `web_app/modifMdp.php`.
* Constatez l'absence de protection CSRF (pas de jeton cach√©).

. **Correction (Question C1)**
* G√©n√©rez un token de session au d√©but du fichier.
* Ajoutez le champ cach√© `<input type="hidden" ...>` dans le formulaire.
* V√©rifiez la validit√© du token dans `web_app/traitement.php`.

[WARNING]
====
Si vous utilisez l'interpr√©teur PHP int√©gr√© √† IntelliJ, pensez √† configurer le chemin vers `php.exe` dans les param√®tres (_Settings -> PHP_).
====

== üêò Lancer l'application Web avec Laragon

. Lancez **Laragon**.
. Cliquez sur le bouton **Racine** (Root) pour ouvrir le dossier `C:\laragon\www`.
. Cr√©ez un dossier nomm√© `yak`.
. Copiez-y tout le contenu du dossier `web_app` de ce projet.
. Dans Laragon, cliquez sur **Tout Lancer** (Start All).
. Laragon devrait afficher une notification : _"Project: yak"_.
. Ouvrez votre navigateur et allez sur : **http://yak.test**
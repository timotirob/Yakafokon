= ğŸ§ª ScÃ©narios de Validation - SÃ©curitÃ© Web (Dossier C)
:author: Yak-Ã -Partir Security Team
:icons: font
:toc: left
:toc-title: Plan de Test
:source-highlighter: highlightjs
:sectnums:

== ğŸ¯ Objectif

Ce document dÃ©crit la procÃ©dure de validation technique pour la **Mission C1** (Protection CSRF).
L'objectif est de prouver que le correctif appliquÃ© dans `modifMdp.php` et `traitement.php` est efficace et robuste.

[IMPORTANT]
====
Ces tests doivent Ãªtre rÃ©alisÃ©s **aprÃ¨s** avoir appliquÃ© vos corrections PHP.
Assurez-vous que votre serveur Laragon est lancÃ© et accessible via `http://yak.test`.
====

== ğŸ§ª ScÃ©nario 1 : Le "Happy Path" (Fonctionnement Nominal)

**Objectif :** VÃ©rifier que la protection n'empÃªche pas un utilisateur lÃ©gitime de changer son mot de passe.

. **Connexion**
* Connectez-vous avec le compte de test : `RichardP` / `password123`.

. **Action**
* Sur le formulaire, saisissez un nouveau mot de passe (ex: `Azerty123!`).
* Validez le formulaire.

. **RÃ©sultat Attendu**
* âœ… Vous devez voir le message de succÃ¨s : _"SuccÃ¨s ! Votre mot de passe a Ã©tÃ© mis Ã  jour..."_.

. **VÃ©rification Technique (Base de donnÃ©es)**
* Ouvrez la console _Database_ dans IntelliJ (ou bien HeidiSQL sur Laragon)
* ExÃ©cutez la requÃªte suivante pour vÃ©rifier la mise Ã  jour :
+
[source,sql]
----
SELECT * FROM Client WHERE pseudo = 'RichardP';
----
* Le champ `mdp` doit contenir la nouvelle valeur.

== ğŸ•µï¸ ScÃ©nario 2 : L'Inspection (VÃ©rification du Jeton)

**Objectif :** VÃ©rifier visuellement la prÃ©sence du jeton de sÃ©curitÃ© (Token) dans le code source gÃ©nÃ©rÃ©.

. **Action**
* Connectez-vous et accÃ©dez Ã  la page de changement de mot de passe.
* Ouvrez les outils de dÃ©veloppement (**F12** ou Clic-droit -> _Inspecter_).
* Recherchez la balise `<form>`.

. **RÃ©sultat Attendu**
* âœ… Vous devez trouver un champ cachÃ© contenant une chaÃ®ne alÃ©atoire, ressemblant Ã  ceci :
+
[source,html]
----
<input type="hidden" name="token" value="a4f5b89c3...">
----

[WARNING]
====
Si cette ligne est absente, votre fichier `modifMdp.php` n'est pas correctement corrigÃ©.
====

== ğŸ´â€â˜ ï¸ ScÃ©nario 3 : L'Attaque SimulÃ©e (Test CSRF)

**Objectif :** Simuler une attaque provenant d'un site malveillant pour prouver que la faille est colmatÃ©e.

. **PrÃ©paration du PiÃ¨ge**
* CrÃ©ez un fichier nommÃ© `hacker.html` (sur votre Bureau ou dans le dossier du projet).
* Collez-y le code suivant :
+
[source,html]
----
<h1>ğŸ BRAVO ! VOUS AVEZ GAGNÃ‰ UN IPHONE ! ğŸ</h1>
<p>Cliquez ci-dessous pour rÃ©clamer votre lot :</p>

<form action="http://yak.test/traitement.php?action=modifMdp" method="POST">
    <input type="hidden" name="pwd" value="HACKED">

    <button type="submit" style="background:red; color:white; font-size:20px; padding:10px;">
        RÃ‰CLAMER MON CADEAU
    </button>
</form>
----

. **ExÃ©cution de l'Attaque**
* Assurez-vous d'Ãªtre connectÃ© sur `http://yak.test` dans un onglet (votre session est active).
* Ouvrez le fichier `hacker.html` dans un **nouvel onglet** du mÃªme navigateur.
* Cliquez sur le bouton "RÃ‰CLAMER MON CADEAU".

. **RÃ©sultat Attendu**
* âœ… **Si corrigÃ©** : Vous devez Ãªtre redirigÃ© vers une page d'erreur ou voir un message **"ERREUR DE SÃ‰CURITÃ‰ (CSRF)"** (Code 403).
* âŒ **Si vulnÃ©rable** : Vous voyez "SuccÃ¨s". Votre mot de passe a Ã©tÃ© remplacÃ© par "HACKED".

== ğŸ”§ ScÃ©nario 4 : Le Sabotage (AltÃ©ration de DonnÃ©es)

**Objectif :** VÃ©rifier que le serveur compare strictement le token reÃ§u et le token en session.

. **Action**
* Connectez-vous lÃ©gitimement sur la page de modification.
* Ouvrez l'inspecteur (**F12**).
* Localisez le champ `<input type="hidden" name="token" ...>`.
* Double-cliquez sur la valeur du token (l'attribut `value`) pour l'Ã©diter.
* **Modifiez un seul caractÃ¨re** (ex: changez un `a` en `b`) et appuyez sur EntrÃ©e.
* Cliquez sur le bouton "Valider" du formulaire.

. **RÃ©sultat Attendu**
* âœ… Le serveur doit rejeter la demande (Message d'erreur ou page blanche selon votre implÃ©mentation).
* Cela prouve que `$_POST['token']` est bien comparÃ© Ã  `$_SESSION['token']` dans `traitement.php`.

---
*Fin du protocole de validation.*